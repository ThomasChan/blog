<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>let&#39;s-learn-RxJS | 追客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/blog/favicon.ico">
  <link rel="stylesheet" href="/blog/css/app.css" type="text/css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
</head>

<body>
  <nav class="app-nav">
  
      
        <a class="active" href="/blog/.">home</a>
        

      
  
      
        <a href="/blog/archives">archive</a>
      
  
      
        <a href="/blog/about">about</a>
      
  
      
        <a href="/blog/atom.xml">rss</a>
      
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/blog/2016/04/23/let-us-learn-RxJS/">let's-learn-RxJS</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">April 23 2016</p>
  </section>

  <section class="article-entry">
    <h2 id="Observable__u548C_Generator__u7684_u533A_u522B"><a href="#Observable__u548C_Generator__u7684_u533A_u522B" class="headerlink" title="Observable 和 Generator 的区别"></a>Observable 和 Generator 的区别</h2><p>我们先来看一下 Generator 的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Producer</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">baz</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">42</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">100</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">200</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Consumer</span></span><br><span class="line"><span class="keyword">const</span> interator = baz()</span><br><span class="line">cosole.log(interator.next().value)</span><br><span class="line">cosole.log(interator.next().value)</span><br><span class="line">cosole.log(interator.next().value)</span><br></pre></td></tr></table></figure>
<p>可以发现，<strong>Consumer 决定了什么时候返回值</strong>。这种风格叫做 <em>PULL</em> 。</p>
<p>在回头看看我们的 Observable ：<br><strong>Producer 决定了什么时候返回值</strong>。这种风格叫做 <em>PUSH</em> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Producer</span></span><br><span class="line"><span class="keyword">const</span> bar = Rx.Observable.create(observer =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>)</span><br><span class="line">  observer.next(<span class="number">42</span>)</span><br><span class="line">  observer.next(<span class="number">100</span>)</span><br><span class="line">  observer.next(<span class="number">200</span>)</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    observer.next(<span class="number">3000</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Comsumer</span></span><br><span class="line">bar.subscribe(x =&gt; <span class="built_in">console</span>.log(x))</span><br></pre></td></tr></table></figure>
<h2 id="Observable__u4E5F_u53EF_u4EE5_u629B_u51FA_u9519_u8BEF"><a href="#Observable__u4E5F_u53EF_u4EE5_u629B_u51FA_u9519_u8BEF" class="headerlink" title="Observable 也可以抛出错误"></a>Observable 也可以抛出错误</h2><p>为了提高代码的健壮性，我们通常需要 <code>try-catch</code> 我们代码可能发生的错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>)</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'invalid something'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(foo.call())</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Something wrong happened: <span class="subst">$&#123;err&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'This here still runs'</span>)</span><br></pre></td></tr></table></figure>
<p>那么我们怎么在 Observable 里面抛出以及捕捉错误呢？<br>很简单。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bar = Rx.Observable.create(observer =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello'</span>)</span><br><span class="line">    observer.next(<span class="number">42</span>)</span><br><span class="line">    observer.next(<span class="number">100</span>)</span><br><span class="line">    observer.next(<span class="number">200</span>)</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      observer.next(<span class="number">3000</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    observer.error(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'bad'</span>)) <span class="comment">// 抛出错误</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Comsumer</span></span><br><span class="line">bar.subscribe(</span><br><span class="line">  x =&gt; <span class="built_in">console</span>.log(x),</span><br><span class="line">  err =&gt; <span class="built_in">console</span>.log(<span class="string">`Something went wrong <span class="subst">$&#123;err&#125;</span>`</span>) <span class="comment">// 捕捉错误</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="Observable_can_complete"><a href="#Observable_can_complete" class="headerlink" title="Observable can complete"></a>Observable can complete</h2><p>我们知道，Observable 可以返回一个值，也可以抛出捕捉错误。<br>现在我告诉你，我们还可以指定 Observable 什么时候 complete(结束)。complete 之后，就不能再返回任何值了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bar = Rx.Observable.create(observer =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello'</span>)</span><br><span class="line">    observer.next(<span class="number">42</span>)</span><br><span class="line">    observer.complete() <span class="comment">// complete observable</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// the following will not emit, </span></span><br><span class="line">    <span class="comment">// because the Observable has complete</span></span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      observer.next(<span class="number">3000</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    observer.error(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'bad'</span>)) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">bar.subscribe(</span><br><span class="line">  x =&gt; <span class="built_in">console</span>.log(x),</span><br><span class="line">  err =&gt; <span class="built_in">console</span>.log(<span class="string">`Something went wrong <span class="subst">$&#123;err&#125;</span>`</span>),</span><br><span class="line">  () =&gt; <span class="built_in">console</span>.log(<span class="string">'done'</span>) <span class="comment">// complete callback</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 'Hello'</span></span><br><span class="line"><span class="comment">// 42</span></span><br><span class="line"><span class="comment">// 'done'</span></span><br></pre></td></tr></table></figure>
<p>上面的例子中，并没有在 log <code>3000</code> ，因为在此之间我们的 Observable 已经 complete 了。</p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> 追客 </p>
      <p class="subtitle"> You are the JavaScript in my HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <p> share it if you like it~ </p>
    <!-- <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text= id="Observable__u54"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>
 -->
  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://drakeleung.github.io/blog/2016/04/23/let-us-learn-RxJS/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
