<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>「译」Learning React Without Using React Part2 | 追客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css" type="text/css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
</head>

<body>
  <nav class="app-nav">
  
      
        <a class="active" href="/.">home</a>
        

      
  
      
        <a href="/archives">archive</a>
      
  
      
        <a href="/about">about</a>
      
  
      
        <a href="/atom.xml">rss</a>
      
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2016/03/22/Learning-React-Without-Using-React-Part-2/">「译」Learning React Without Using React Part2</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">March 22 2016</p>
  </section>

  <section class="article-entry">
    <p><em><a href="https://medium.com/javascript-inside/learning-react-without-using-react-part-2-703621a89432#.guh60nwi7" target="_blank" rel="external">原文链接</a></em></p>
<p>请阅读 <a href="http://drakeleung.github.io/blog/2016/03/20/Learning-React-Without-Using-React-Part-1/">Part 1</a> 如果你还没有的话。</p>
<p>让我们继续 Part1 没讲到的东西。<br>我们这两篇文章主要是专注于如何重构我们的 todo list。现在，我们的实现包含了可以渲染整个应用的函数（组合），还有管理我们状态（state）的 <em>store</em>。然而，我们还有很多方法去优化我们的应用。<a href="http://plnkr.co/edit/fjQbQwZpQlhd5wXoc9J8?p=preview" target="_blank" rel="external">完整代码请查看这里</a>。</p>
<p>首先，我们还没有正确地处理事件。现在，我们的组件根本就没有绑定任何事件。在 React 里面，数据流是从上往下，而事件流则是从下往上（In React data flows down while events move up）。也就是说，当事件触发的时候，我们应该沿着组件链，从下往上找其对应的回调函数。比如，我们的 <code>ItemRow</code> 函数应该调用一个从 <code>props</code> 传递下来的函数。</p>
<p>那么，我们怎么实现呢？下面是一个小尝试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemRow</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> className = props.completed ? <span class="string">'item completed'</span> : <span class="string">'item'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $(<span class="string">'&lt;li&gt;'</span>)</span><br><span class="line">    .on(<span class="string">'click'</span>, props.onUpdate.bind(<span class="literal">null</span>, props.id))</span><br><span class="line">    .addClass(className)</span><br><span class="line">    .attr(<span class="string">'id'</span>, props.id)</span><br><span class="line">    .html(props.text)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面，我们给 <code>list</code> 元素绑定了一个事件。当点击他们的时候，<code>onUpdate</code> 函数就会被调用。</p>
<p>现在，我们不妨定义一个函数，他可以在创建元素的时候同时为其绑定事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span> (<span class="params">tag, attrs, children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> elem = $(<span class="string">'&lt;'</span>, + tag + <span class="string">'&gt;'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> attrs) &#123;</span><br><span class="line">    <span class="keyword">var</span> val = attrs[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (key.indexOf(<span class="string">'on'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> event = key.substr(<span class="number">2</span>).toLowerCase()</span><br><span class="line">      elem.on(event, val)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      elem.attr(key, val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> elem.html(children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样一来，我们的 <code>ItemRow</code> 函数可以写成这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function ItemRow (props) &#123;</span><br><span class="line">  var className = props.completed ? 'item completed' : 'item'</span><br><span class="line"></span><br><span class="line">  return createElement('li', &#123;</span><br><span class="line">    id: props.id,</span><br><span class="line">    class: props.className,</span><br><span class="line">    onClick: props.onUpdate.bind(null, props.id)</span><br><span class="line">  &#125;, props.text)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是 React 中的 <code>createElement</code> 函数是创建了一个 JavaScript 对象来表示 DOM 元素。还有一点，让我们来看看 React 中的 JSX 语法到底是怎样子的。</p>
<p>下面就是一个 JSX 例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> ( <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">'el'</span> <span class="attribute">className</span>=<span class="value">'entry'</span>&gt;</span> Hello <span class="tag">&lt;/<span class="title">div</span>&gt;</span>)</span></span><br></pre></td></tr></table></figure>
<p>接着会转换成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SomeElement = React.createElement(<span class="string">'div'</span>, &#123;</span><br><span class="line">  id: <span class="string">'el'</span>,</span><br><span class="line">  className: <span class="string">'entry'</span></span><br><span class="line">&#125;, <span class="string">'Hello'</span>)</span><br></pre></td></tr></table></figure>
<p>然后调用 <code>SomeElement</code> 函数会返回一个像下面差不多的 JavaScript 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  type: <span class="string">'div'</span>,</span><br><span class="line">  key: <span class="literal">null</span>,</span><br><span class="line">  ref: <span class="literal">null</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    children: <span class="string">'Hello'</span>,</span><br><span class="line">    className: <span class="string">'entry'</span>,</span><br><span class="line">    id: <span class="string">'el'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想要了解更多的话，请阅读 <a href="https://medium.com/@dan_abramov/react-components-elements-and-instances-90800811f8ca#.x2b1qra2o" target="_blank" rel="external">React Components, Elements, and Instances</a></p>
<p>回到我们的例子中，<code>onUpdate</code> 函数是从哪里来的？</p>
<p>现在来看看我们的 <code>render</code> 函数。他定义了一个 <code>updateState</code> 函数，然后通过 <code>props</code> 把这个函数传给 <code>ItemList</code> 组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">props, node</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateState</span> (<span class="params">toggleId</span>) </span>&#123;</span><br><span class="line">    state.items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (el.id === toggleId) &#123;</span><br><span class="line">        el.completed = !el.completed</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    store.setState(state)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  node.empty().append([ItemList(&#123;</span><br><span class="line">    items: props.items,</span><br><span class="line">    onUpdate: updateState</span><br><span class="line">  &#125;)])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，<code>ItemList</code> 函数会把 <code>onUpdate</code> 传到每个 <code>ItemRow</code> 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">functions extending(base, item) &#123;</span><br><span class="line">  <span class="keyword">return</span> $.extend(&#123;&#125;, item, base)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemsList</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createElement(<span class="string">'ul'</span>, &#123;&#125;, props.items</span><br><span class="line">    .map(extending.bind(<span class="literal">null</span>, &#123;onUpdate: props.onUpdate&#125;))</span><br><span class="line">  )</span><br><span class="line">    .map(ItemRow)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上我们实现了：数据流是从下往下的，而事件流是从下往上。这就意味着我们可以把定义在全局的监听器移除掉（用来监听点击 item 的时候，改变他的状态）。我们把这个函数移到了 <code>render</code> 函数里面，也就是前面所讲的 <code>updateState</code>。</p>
<p><strong> 我们还可以重构。 </strong></p>
<p>现在我们把 <code>input</code> 和 <code>button</code> 从 HTML 标签变成函数。因此，我们整个 HTML 文件就只剩下一个 <code>div</code> 。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"app"</span>&gt;</span><span class="tag">&lt;/<span class="title">app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们的 <code>input</code> 元素很容易创建，就这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = createElement(<span class="string">'input'</span>, &#123;id: <span class="string">'input'</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>同样地，我们也可以把监听搜索框按钮点击的全局函数放在我们的 <code>SearchBar</code> 函数里面。<code>SearchBar</code> 函数会返回一个 <code>input</code> 和一个 <code>button</code> 元素，他会通过 <code>props</code> 传进来的回调函数来处理点击事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">functions SearchBar(props) &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onButtonClick</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = $(<span class="string">'#input'</span>).val()</span><br><span class="line">    $(<span class="string">'#input'</span>).val(<span class="string">''</span>)</span><br><span class="line">    props.update(val)</span><br><span class="line">    e.preventDefault()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> input = createElement(<span class="string">'input'</span>, &#123;id: <span class="string">'input'</span>&#125;)</span><br><span class="line">  <span class="keyword">var</span> button = createElement(<span class="string">'button'</span>, &#123;</span><br><span class="line">    id: <span class="string">'add'</span>,</span><br><span class="line">    onClick: onButtonClick.bind(<span class="literal">null</span>)</span><br><span class="line">  &#125;, <span class="string">'Add'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> createElement(<span class="string">'div'</span>, &#123;&#125;, &#123;input, button&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们的 <code>render</code> 函数调用 <code>SearchBar</code> 的同时传递正确的 <code>props</code> 参数。在我们更新 <code>update</code> 函数之前，让我们想想 <em>re-render</em> 应该在哪里调用才是正确的。首先，忽略我们的 <code>store</code>，把注意力集中在如何在一个 high level component 中处理 <em>state</em>。</p>
<p>目前为止，所有的函数都是 <em>stateless</em> 的。接下来我们会创建一个函数，他会处理 <em>state</em> ，以及在适当的时候更新子组件（children）。</p>
<p><strong>Container Component</strong></p>
<p>让我们来创建一个 high level container 吧。与此同时，为了更好理解，你可以阅读 <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.iy4tfncwt" target="_blank" rel="external">Presentational and Container Component</a>。</p>
<p>首先，我们给这个 container component 取名为 <code>App</code>。他所做的事情就是调用 <code>SearchBar</code> 和 <code>ItemList</code> 函数。现在，我们继续重构 <code>render</code> 函数。其实就是把代码移到 <code>App</code> 里面去而已。</p>
<p>我们不妨先来看看 <code>render</code> 现在是怎样子的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">component, node</span>) </span>&#123;</span><br><span class="line">  node.empty().append(component)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(App(state), $(<span class="string">'#app'</span>))</span><br></pre></td></tr></table></figure>
<p>我们的 <code>render</code> 函数只是简单地把整个应用渲染到指定的节点中。但是，React 的实现会比这个复杂一点，而我们仅仅把一棵 element tree 添加到指定的根节点中而已。但是抽象起来理解的话，这个已经足够了。</p>
<p>现在，我们的 <code>App</code> 函数其实就是我们旧的 <code>render</code> 函数，除了 DOM 操作被删掉。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateSearchBar</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    state.items.push(&#123;</span><br><span class="line">      id: state.id++,</span><br><span class="line">      text: value,</span><br><span class="line">      completed: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateState</span> (<span class="params">toggleId</span>) </span>&#123;</span><br><span class="line">    state.items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (el.id === toggleId) &#123;</span><br><span class="line">        el.completed = !el.completed</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    store.setState(state)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    SearchBar(&#123;update: updateSearchBar&#125;),</span><br><span class="line">    ItemsList(&#123;items: props.items, onUpdate: updateState&#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们还需要改进一样东西：我们访问的 <code>store</code> 是全局的，并且重新渲染的话需要调用 <code>setState</code> 函数。</p>
<p>我们现在来重构 <code>App</code> 函数，使得他的子组件重新渲染的是不需要调用 <code>store</code> 。那么应该要怎么实现呢？</p>
<p>首先我们要忽略 <code>store</code>，并且想想怎么调用 <code>setState</code> 函数，从而使得组件和他的子组件重新渲染。</p>
<p>我们需要跟踪这个 high level component 当前的状态，并且只要 <code>setState</code> 一调用，就立马重新渲染。下面是一个简单的实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getInitialState</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      items: [],</span><br><span class="line">      id: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> _state = getInitialState(),</span><br><span class="line">    _node = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setState</span> (<span class="params">state</span>) </span>&#123;</span><br><span class="line">    _state = state</span><br><span class="line">    render()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过调用 <code>getInitialState</code> 来初始化我们的 <code>state</code> ，然后每当使用 <code>setState</code> 来更新状态的时候，我们会调用 <code>render</code> 函数。</p>
<p>而 <code>render</code> 函数要么创建一个 node，要么简单地更新 node，只要 <code>state</code> 发生改变。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// naive implement of render</span><br><span class="line"></span><br><span class="line">function render () &#123;</span><br><span class="line">  var children = [</span><br><span class="line">    SearchBar(&#123;update: updateSearchState&#125;),</span><br><span class="line">    ItemList(&#123;</span><br><span class="line">      items: _state.items,</span><br><span class="line">      onUpdate: updateState</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  if (!_node) &#123;</span><br><span class="line">    return _node = createElement('div', &#123;class: 'top'&#125;, children)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return _node.html(children)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很显然，这对性能来说是不好的。需要知道的是，React 中的 <code>setState</code> 不会渲染整个应用，而是组件和他的子组件。</p>
<p>下面是 <code>render</code> 函数的最新代码，我们调用 <code>App</code> 时不需要带任何参数，只是需要简单地调用 <code>getInitialState</code>返回初始的状态。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">component, node</span>) </span>&#123;</span><br><span class="line">  node.empty().append(component);</span><br><span class="line">&#125;</span><br><span class="line">render(App(), $(<span class="string">'#app'</span>));</span><br></pre></td></tr></table></figure>
<p><a href="http://plnkr.co/edit/ISi8AiVuYSfFIfMy9z6t?p=preview" target="_blank" rel="external">查看的所有的代码请点击这里</a></p>
<p><strong>继续改进</strong></p>
<p>如果有一个函数，他会返回一个对象。这个对象包含了 <code>setState</code> 函数，还能够区分传进来 <code>props</code> 和 组件本身自己的 <code>state</code>。</p>
<p>差不多就像下面这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var App = createClass(&#123;</span><br><span class="line">  updateSearchState: function (string) &#123; /*...*/ &#125;,</span><br><span class="line"></span><br><span class="line">  updateState: function (obj) &#123; /*... */ &#125;,</span><br><span class="line"></span><br><span class="line">  render: function () &#123;</span><br><span class="line">    var children = [</span><br><span class="line">      SearchBar(&#123;</span><br><span class="line">        updateSearchState: this.updateSearchState</span><br><span class="line">      &#125;),</span><br><span class="line">      ItemsList(&#123;</span><br><span class="line">        items: this.state.items,</span><br><span class="line">        onUpdate: this.updateState</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    return createElement('div', &#123;class: 'top'&#125;, children)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>很幸运的是，在 React 中，你可以通过调用 <code>React.createClass</code> 来创建组件。他提供了很多选择，比如 ES6 Class ，stateless function 等，<a href="https://facebook.github.io/react/docs/reusable-components.html" target="_blank" rel="external">更多请查看文档</a>。</p>
<p>综上，我们讲解了数据流如何从上往下，而事件从下往上。我们也看到了如何处理一个组件的状态。关于 React 的东西，还有很多要学习。下面的链接也许可以帮助到你。</p>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://facebook.github.io/react/docs/thinking-in-react.html" target="_blank" rel="external">Thnking in React</a></li>
<li><a href="https://facebook.github.io/react/docs/getting-started.html" target="_blank" rel="external">Getting Start React</a></li>
<li><a href="https://medium.com/javascript-scene/jsx-looks-like-an-abomination-1c1ec351a918#.59q26eqe0" target="_blank" rel="external">JSX</a></li>
<li><a href="https://github.com/petehunt/react-howto" target="_blank" rel="external">React How to</a></li>
<li><a href="http://jlongster.com/Removing-User-Interface-Complexity,-or-Why-React-is-Awesome" target="_blank" rel="external">Removing User Interface Complexity, or Why React is Awesome</a></li>
<li><a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.kcyewm6ab" target="_blank" rel="external">Presentational and Container Component</a></li>
<li><a href="https://medium.com/@dan_abramov/react-components-elements-and-instances-90800811f8ca#.xis6z3p1z" target="_blank" rel="external">React Component, Elements, and Instances</a></li>
</ul>
<p><strong>结尾语</strong></p>
<p>本来打算在这篇文章讲解如何创建一个 <em>advanced state container</em> ，实现 <em>undo/redo</em> 以及更多 feature ，但是我认为已经超出了这篇文章的范围。</p>
<p>如果大家有兴趣的话，我也许会写 Part 2.1。</p>
<p><em><a href="https://medium.com/javascript-inside/learning-react-without-using-react-part-2-703621a89432#.guh60nwi7" target="_blank" rel="external">原文链接</a></em></p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> 追客 </p>
      <p class="subtitle"> You are the JavaScript in my HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=<em><a href="https:/"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://drakeleung.github.io/blog/2016/03/22/Learning-React-Without-Using-React-Part-2/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
